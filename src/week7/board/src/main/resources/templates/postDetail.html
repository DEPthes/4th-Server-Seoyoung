<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>게시글 상세</title>
</head>
<body>

<h2 id="title">제목</h2>

<!-- 로그인한 사용자의 게시글일 때만 보이도록 JS에서 제어 -->
<div id="authButtons" style="display: none;">
    <a id="editLink">
        <button type="button">수정하기</button>
    </a>

    <button id="deleteBtn">삭제하기</button>
</div>

<p><strong>작성자:</strong> <span id="authorNickname"></span></p>
<p><strong>작성일:</strong> <span id="createdAt"></span></p>

<hr/>
<p id="content">내용</p>

<hr/>
<a href="/posts">전체 게시글 목록</a>
<a href="/posts/mine">내 게시글 목록</a>
<script>
    const postId = window.location.pathname.split("/").pop();

    fetch(`/api/posts/${postId}`)
        .then(res => res.json())
        .then(post => {
            document.getElementById("title").textContent = post.title;
            document.getElementById("content").textContent = post.content;
            document.getElementById("authorNickname").textContent = post.authorNickname;
            document.getElementById("createdAt").textContent = new Date(post.createdAt).toLocaleString();
            document.getElementById("editLink").href = `/posts/edit/${post.id}`;

            if (post.mine) {
                document.getElementById("authButtons").style.display = "block";
            }
        })
        .catch(err => {
            alert("데이터를 불러오지 못했습니다.");
            console.error(err);
        });

    document.getElementById("deleteBtn").addEventListener("click", function () {
        if (!confirm("정말 삭제하시겠습니까?")) return;

        fetch(`/api/posts/${postId}`, {
            method: 'DELETE'
        })
            .then(res => {
                if (res.status === 204) {
                    alert("삭제 완료!");
                    window.location.href = "/posts/mine";
                } else if (res.status === 403) {
                    alert("본인만 삭제할 수 있습니다.");
                } else {
                    alert("삭제에 실패했습니다.");
                }
            })
            .catch(err => {
                alert("에러가 발생했습니다.");
                console.error(err);
            });
    });
</script>



</body>
</html>
